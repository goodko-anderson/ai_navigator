{% extends 'base.html' %}
{% load static %}

{% block title %}AI è‡ªå‹•å¯«æ‰‹ - å¯¦æˆ°å¯¦é©—å®¤{% endblock %}

{% block content %}
<style>
    /* =========================================
       1. é é¢å°ˆå±¬èƒŒæ™¯ç‰¹æ•ˆ (éˆæ„Ÿæµå‹•ä¸»é¡Œ)
       ========================================= */
    body {
        background-color: #0b0f19 !important;
        overflow-x: hidden;
    }

    /* èƒŒæ™¯ç¶²æ ¼ç·š */
    .hero-grid {
        position: absolute; top: 0; left: 0; width: 100%; height: 100vh;
        background-image: 
            linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        pointer-events: none; z-index: 0;
        mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 20%, rgba(0,0,0,0) 80%);
    }

    /* å…‰çƒç‰¹æ•ˆ */
    .glow-blob-blue {
        position: fixed; top: -10%; left: -10%; width: 600px; height: 600px;
        background: radial-gradient(circle, rgba(13, 110, 253, 0.25) 0%, rgba(0,0,0,0) 70%);
        border-radius: 50%; filter: blur(80px); z-index: 0;
        animation: floatBlob 25s infinite alternate; pointer-events: none;
    }
    .glow-blob-cyan {
        position: fixed; bottom: 10%; right: -5%; width: 500px; height: 500px;
        background: radial-gradient(circle, rgba(13, 202, 240, 0.2) 0%, rgba(0,0,0,0) 70%);
        border-radius: 50%; filter: blur(60px); z-index: 0;
        animation: floatBlob 20s infinite alternate-reverse; pointer-events: none;
    }
    @keyframes floatBlob {
        0% { transform: translate(0, 0) scale(1); }
        100% { transform: translate(30px, 50px) scale(1.1); }
    }

    /* =========================================
       2. ç‰ˆé¢æ¨£å¼èˆ‡äº’å‹•
       ========================================= */
    .container { position: relative; z-index: 2; }

    /* é‹¼ç­†äº’å‹•ç‰¹æ•ˆ */
    .writer-icon-wrapper { 
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        cursor: default; 
        position: relative; z-index: 2;
    }
    .writer-icon-wrapper:hover { 
        transform: scale(1.1); 
        background-color: rgba(13, 110, 253, 0.3) !important; 
        box-shadow: 0 0 30px rgba(13, 110, 253, 0.5); 
    }
    .writer-icon-wrapper:hover .writer-icon { 
        animation: writing-wiggle 0.5s ease-in-out infinite alternate; 
        color: #fff !important; 
    }
    @keyframes writing-wiggle { 
        0% { transform: rotate(0deg) translateY(0); } 
        100% { transform: rotate(-20deg) translateY(-5px); } 
    }

    /* ğŸ‘‡ é—œéµä¿®æ­£ï¼šåŠ ä¸Š #aiWriterForm é™å®šç¯„åœï¼Œä¸å½±éŸ¿å°è¦½åˆ— */
    #aiWriterForm input[type="text"], 
    #aiWriterForm textarea, 
    #aiWriterForm select {
        background-color: rgba(15, 23, 42, 0.8) !important;
        backdrop-filter: blur(10px);
        border: 1px solid #334155 !important; 
        color: #fff !important;
        padding: 15px; 
        border-radius: 12px; 
        font-size: 1.1rem; 
        transition: all 0.3s ease;
    }
    
    /* Focus ç‹€æ…‹ä¹ŸåŠ ä¸Šé™å®šç¯„åœ */
    #aiWriterForm input[type="text"]:focus {
        border-color: #0d6efd !important; 
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
        background-color: #1e293b !important;
    }
    
    /* æ·±æµ·è—æŒ‰éˆ• */
    .btn-tech-blue {
        background: linear-gradient(135deg, #0d6efd, #0a58ca);
        border: none; color: white !important; padding: 12px; border-radius: 50px;
        transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
    }
    .btn-tech-blue:hover {
        background: linear-gradient(135deg, #0b5ed7, #084298);
        box-shadow: 0 0 25px rgba(13, 110, 253, 0.6); transform: translateY(-2px);
    }

    /* å¡ç‰‡ç»ç’ƒæ“¬æ…‹ */
    .glass-card {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        border-radius: 16px;
    }
    
    /* å‹•ç•« */
    .animate-pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
</style>

<div class="hero-grid"></div>
<div class="glow-blob-blue"></div>
<div class="glow-blob-cyan"></div>

<div class="container" style="padding-top: 110px; padding-bottom: 100px;">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            
            <div class="text-center mb-5">
                <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-25 text-primary rounded-circle mb-3 writer-icon-wrapper" style="width: 80px; height: 80px;">
                    <i class="fa-solid fa-pen-nib fa-3x writer-icon"></i>
                </div>
                <h1 class="display-5 fw-bold text-white" style="text-shadow: 0 0 20px rgba(13, 110, 253, 0.5);">AI è‡ªå‹•å¯«æ‰‹</h1>
                <p class="text-muted lead">è¼¸å…¥ä¸»é¡Œï¼ŒAI å°‡ç‚ºæ‚¨ç”Ÿæˆå®Œæ•´çš„ HTML æ•™å­¸æ–‡ç« çµæ§‹ã€‚</p>
            </div>

            <div class="card glass-card mb-5">
                <div class="card-body p-5">
                    <form method="post" id="aiWriterForm">
                        {% csrf_token %}
                        <div class="mb-4">
                            <label for="{{ form.topic.id_for_label }}" class="form-label text-white fw-bold mb-3">
                                <i class="fa-regular fa-keyboard me-2 text-primary"></i>æ–‡ç« ä¸»é¡Œ
                            </label>
                            {{ form.topic }}
                            <div class="form-text text-muted mt-3">
                                <i class="fa-solid fa-circle-info me-1"></i> 
                                ä¾‹å¦‚ï¼šã€ŒMidjourney V6 æ–°æ‰‹æ•™å­¸ã€ã€ã€ŒPython çˆ¬èŸ²å…¥é–€ã€ã€ã€ŒSora å½±ç‰‡ç”ŸæˆæŒ‡å—ã€
                            </div>
                        </div>
                        <div class="d-grid pt-2">
                            <button type="submit" class="btn btn-tech-blue btn-lg fw-bold" id="submitBtn">
                                <i class="fa-solid fa-bolt me-2"></i> é–‹å§‹ç”Ÿæˆæ–‡ç« 
                            </button>
                        </div>
                    </form>
                    
                    <div id="loadingArea" class="d-none text-center mt-5">
                        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h5 class="text-white animate-pulse">AI æ­£åœ¨æ’°å¯«æ–‡ç« ä¸­ï¼Œè«‹ç¨å€™...</h5>
                        <p class="text-muted small">é€™å¯èƒ½éœ€è¦ 10~30 ç§’ï¼Œè«‹å‹¿é—œé–‰è¦–çª—</p>
                    </div>
                </div>
            </div>

            {% if new_project %}
            <div class="card glass-card border-0 animate-fade-in-up">
                <div class="card-header bg-primary bg-opacity-25 border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-white"><i class="fa-solid fa-check-circle text-primary me-2"></i>ç”ŸæˆæˆåŠŸï¼</h5>
                        <span class="badge bg-primary rounded-pill px-3">Completed</span>
                    </div>
                </div>
                <div class="card-body p-4">
                    <h4 class="text-white fw-bold mb-3">{{ new_project.title }}</h4>
                    <div class="alert alert-secondary d-flex align-items-center border-0 bg-opacity-10" role="alert" style="background-color: rgba(255,255,255,0.05); color: #cbd5e1;">
                        <i class="fa-solid fa-wrench text-primary me-3 fa-2x"></i>
                        <div>
                            <strong class="text-white">è‡ªå‹•é—œè¯å·¥å…·ï¼š</strong>
                            {% if new_project.related_tool %}
                                <span class="text-primary fw-bold">{{ new_project.related_tool.name }}</span> (å·²è‡ªå‹•ç¶å®šåœ–ç‰‡)
                            {% else %}
                                <span class="text-muted">ç„¡ (å»ºè­°åœ¨æ¨™é¡ŒåŒ…å«å·¥å…·åç¨±ä»¥è‡ªå‹•ç¶å®š)</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="bg-black p-3 rounded border border-secondary mb-4 text-light opacity-75 font-monospace" style="max-height: 200px; overflow-y: auto; font-size: 0.9rem;">
                        {{ new_project.description|striptags }}
                    </div>
                    <div class="d-flex gap-3">
                        <a href="{% url 'lab_detail' new_project.pk %}" class="btn btn-outline-light flex-grow-1 rounded-pill">
                            <i class="fa-solid fa-eye me-2"></i> æŸ¥çœ‹è©³æƒ…
                        </a>
                        <form action="{% url 'publish_lab_to_article' new_project.pk %}" method="post" class="flex-grow-1">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success w-100 fw-bold rounded-pill shadow">
                                <i class="fa-solid fa-rocket me-2"></i> ç›´æ¥ç™¼å¸ƒåˆ°æ–°æ‰‹æ‘
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.getElementById('aiWriterForm').addEventListener('submit', function(e) {
        var btn = document.getElementById('submitBtn');
        if (btn.disabled) { e.preventDefault(); return; }
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>è™•ç†ä¸­...';
        setTimeout(function() {
            btn.parentElement.classList.add('d-none');
            document.getElementById('loadingArea').classList.remove('d-none');
        }, 100);
    });
</script>
{% endblock %}